<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>SANITA PAKETLEME SESLI ASISTAN</title>
<style>
:root{--accent:#46e0b2;--bg:#041226;--muted:#9fc1b5}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial;background:linear-gradient(180deg,var(--bg),#07253a);color:#e8fff6}
.container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
.card{width:920px;max-width:96%;border-radius:14px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 30px 90px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
.header{display:flex;align-items:center;gap:12px}
.logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,#2AE7B4,#1FBBA1);display:flex;align-items:center;justify-content:center;font-weight:800;color:#022018}
.title{font-weight:800;font-size:18px}
.main{display:flex;gap:16px;margin-top:14px;align-items:flex-start}
.left{width:320px;display:flex;flex-direction:column;align-items:center}
.micOuter{position:relative;width:260px;height:260px;border-radius:999px;display:flex;align-items:center;justify-content:center}
.ring{position:absolute;width:420px;height:420px;border-radius:999px;left:50%;transform:translateX(-50%) scale(.95);pointer-events:none;opacity:0}
.ring.on{opacity:1;animation:ringPulse 1.6s infinite}
@keyframes ringPulse{0%{box-shadow:0 0 0 0 rgba(70,224,178,0.12)}60%{box-shadow:0 0 0 36px rgba(70,224,178,0)}100%{box-shadow:0 0 0 0 rgba(70,224,178,0)}}
.micBtn{width:150px;height:150px;border-radius:999px;background:linear-gradient(90deg,var(--accent),#2fd9a2);border:none;color:#042018;font-size:44px;font-weight:900;cursor:pointer;box-shadow:0 22px 60px rgba(0,0,0,0.45)}
.wave{display:flex;gap:6px;margin-top:12px;opacity:0;transition:opacity .12s}
.bar{width:12px;background:linear-gradient(180deg,var(--accent),#34d399);border-radius:6px;height:14px;transition:height .06s}
.transcript{min-height:56px;text-align:center;color:#dff8f0;font-size:15px;margin-top:10px;padding:6px 12px}
.right{flex:1;display:flex;flex-direction:column;gap:12px}
.response{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);min-height:160px;overflow:auto}
.userText{font-size:14px;color:#cdeee0;margin-bottom:8px}
.resText{font-size:16px;line-height:1.45;color:#e6fff4;white-space:pre-wrap}
.examples{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.example{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:8px;font-size:13px;color:var(--muted);cursor:pointer}
.controls{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.btn{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:50}
.modalCard{background:linear-gradient(180deg,#072733,#05262a);padding:14px;border-radius:10px;width:720px;max-width:94%}
textarea.input{width:100%;height:220px;border-radius:8px;border:none;padding:10px;background:#022a2b;color:#e6fff4}
.note{font-size:13px;color:var(--muted);margin-top:8px}
@media(max-width:920px){ .main{flex-direction:column;align-items:center} .left{width:100%} .micBtn{width:120px;height:120px;font-size:36px} .wave{width:260px} .card{padding:12px} }
</style>
</head>
<body>
<div class="container">
  <div class="card" role="main" aria-label="Sanita Asistan">
    <div class="header">
      <div class="logo">S</div>
      <div>
        <div class="title">SANITA PAKETLEME BILGI ASISTANI</div>
        <div class="note">Sesli komut ile sor â€” Pul Biber ve tÃ¼m hammadde toplamlarÄ± gÃ¶mÃ¼lÃ¼</div>
      </div>
      <div style="margin-left:auto" class="controls">
        <button id="btnPaste" class="btn">SatÄ±r Verisi YapÄ±ÅŸtÄ±r (Opsiyonel)</button>
        <button id="btnClearData" class="btn">Veriyi SÄ±fÄ±rla</button>
      </div>
    </div>

    <div class="main">
      <div class="left">
        <div class="micOuter">
          <div id="ring" class="ring" aria-hidden="true"></div>
          <button id="micBtn" class="micBtn" aria-label="Dinle">ðŸŽ¤</button>
        </div>

        <div id="wave" class="wave" aria-hidden="true">
          <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
          <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>

        <div id="transcript" class="transcript">Mikrofona dokunun ve sorun. (Ä°zin istemezse tarayÄ±cÄ± site izinlerinden mikrofonu aÃ§Ä±n.)</div>
      </div>

      <div class="right">
        <div class="response" aria-live="polite">
          <div id="userText" class="userText"></div>
          <div id="resText" class="resText">Sorunuzu sÃ¶yleyin; cevap burada gÃ¶rÃ¼necek ve sesli okunacaktÄ±r.</div>
        </div>

        <div class="examples" id="examples"></div>

        <div class="controls">
          <button id="chartBtn" class="btn">Hammadde GrafiÄŸi</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Paste modal (for embedding full ROWS) -->
<div id="pasteModal" class="modal" aria-hidden="true">
  <div class="modalCard">
    <div style="font-weight:700;color:#cdeee0">SatÄ±r DÃ¼zeyi Veriyi JSON Olarak YapÄ±ÅŸtÄ±r</div>
    <div style="margin-top:8px;color:var(--muted);font-size:13px">Excel'i CSV->JSON dÃ¶nÃ¼ÅŸtÃ¼rÃ¼p buraya yapÄ±ÅŸtÄ±rÄ±n; Ã¶rnek JSON: [{"FIRMA":"SOFRA","MIKTAR":312,"KULLANILAN HAMMADDE":"PULBIBER","KULLANILAN HAMMADDE MIKTARI":120.5,"URETIM_TARIH":"2025-10-05"}, ...]</div>
    <div style="margin-top:10px"><textarea id="pasteArea" class="input" placeholder='[ {"FIRMA":"SOFRA","MIKTAR":...}, ... ]'></textarea></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="pasteSave" class="btn">GÃ¶m</button>
      <button id="pasteCancel" class="btn">Ä°ptal</button>
    </div>
  </div>
</div>

<script>
/* GOMULU HAMMADDE TOPLAMLARI (AYLIK) */
const HAMMADDE_TOTALS = {
  "CAM FISTIGI":160.00,"YENIBAHAR":920.05,"PULBIBER":20107.24,"TUM BIBER":299.00,"DEFNE YAPRAGI":204.46,"KEKIK":2552.74,
  "ISOT":4130.77,"ANASON":559.52,"HINDISTAN CEVIZI":4154.01,"IHLAMUR":102.00,"MAVI HASHAS":260.00,"CESNI MILD SEASONING":120.00,
  "VANILIN SEKERI":310.00,"SUMAK":1666.49,"BIBERIYE":1436.54,"MIX MARINATION":120.00,"TUZOT":120.00,"TARCIN":2763.43,
  "KIMYON":4475.46,"KORI":1670.06,"LIMON TUZU":9441.80,"KARABIBER":3020.10,"TOZ BIBER":14818.43,"NISASTA BUGDAY":100.00,
  "MAHLEP":38.80,"KARBONAT":342.00,"COREKOTU":30.00,"GALETA UNU":8770.10,"KUS UZUMU":1620.00,"BEYAZ HASHAS":10.00,
  "SARIMSAK":971.80,"NISASTA MISIR":500.00,"ZERDECAL":743.00,"PIZZA SPICE MIX":25.20,"KEBAP SPICE MIX":19.20,"NANE":3869.95,
  "MAYDANOZ":496.80,"CHICKEN SEASONING MIX":19.20,"SPICE MIX":19.20,"BAHARAT KARISIMI":26.88,"FESLEGEN":534.90,"SUSAM":2721.90,
  "ZENCEFIL":196.10,"KISNIS":55.68,"DEREOTU":26.06,"SOGAN":20.00,"BAMYA KURUSU":5.00,"YER FISTIGI":60.10,"SHAWARMA CESNISI":13.50,
  "MASALA CESNISI":12.00,"DENIZ URUNLERI CESNISI":13.50,"YEMEKLIK TUZ":30.00,"TAVUK CESNISI":10.50,"BARBEKU CESNISI":15.00,"ET CESNISI":15.00,
  "MISIR UNU":1850.30,"HIMALAYA TUZU":1033.20,"KAJUN CESNISI":12.00,"MIX 7 TURLU":215.20,"DENIZ TUZU":390.72,"MUSKAT":98.40,
  "SALATA CESNI":8.10,"PATATES CESNI":18.00,"MAKARNA CESNI":8.10,"KABARTMA TOZU":10.00,"KAYA TUZU":288.00,"BALIK MIX":43.20,
  "PIRINC UNU":100.00,"SOS BAHARATI":50.00,"BUGDAY NISASTA":100.00,"AKBIBER":20.00,"GENEL TOPLAM":98988.68
};

/* Satir verisi baÅŸlangÄ±Ã§ta boÅŸ; istersen sayfadan JSON yapÄ±ÅŸtÄ±r */
let ROWS = [];

/* UI refs */
const micBtn = document.getElementById('micBtn'), ring = document.getElementById('ring'), wave = document.getElementById('wave');
const transcript = document.getElementById('transcript'), userText = document.getElementById('userText'), resText = document.getElementById('resText');
const examplesDiv = document.getElementById('examples'), chartBtn = document.getElementById('chartBtn');
const pasteModal = document.getElementById('pasteModal'), pasteArea = document.getElementById('pasteArea'), pasteSave = document.getElementById('pasteSave'), pasteCancel = document.getElementById('pasteCancel');
const btnPaste = document.getElementById('btnPaste'), btnClear = document.getElementById('btnClearData');

/* Examples shown on page (5) */
const EXAMPLES = [
  "SOFRA iÃ§in ne kadar Ã¼rÃ¼n Ã¼retildi?",
  "ÅžEKERCÄ° iÃ§in ne kadar karabiber kullandÄ±k?",
  "6 Ekim'de Ã§alÄ±ÅŸan sayÄ±sÄ± kaÃ§?",
  "Ekim ayÄ±nda toplam kaÃ§ kilogram pul biber kullanÄ±ldÄ±?",
  "KaÃ§ farklÄ± firma ile Ã§alÄ±ÅŸtÄ±k?"
];
EXAMPLES.forEach(t=>{ const d=document.createElement('div'); d.className='example'; d.innerText=t; d.onclick=()=>processQuery(t); examplesDiv.appendChild(d); });

/* TTS seÃ§imi */
let chosenVoice = null;
function chooseVoice(){ const v=speechSynthesis.getVoices(); if(!v||v.length===0) return; chosenVoice = v.find(x=> x.lang && x.lang.toLowerCase().startsWith('tr') && /ahmet|mehmet|ali|arda|yusuf|burak/i.test(x.name)) || v.find(x=> x.lang && x.lang.toLowerCase().startsWith('tr')) || v[0]; }
speechSynthesis.onvoiceschanged = chooseVoice; chooseVoice();
function speakText(txt){ try{ speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(txt); u.lang='tr-TR'; if(chosenVoice) u.voice=chosenVoice; u.rate=1; u.pitch=1; speechSynthesis.speak(u);}catch(e){console.warn(e);} }
function fmt(n){ return Number(n||0).toLocaleString('tr-TR'); }
function valOf(r, keys){ for(const k of keys) if(r && r[k] !== undefined && r[k] !== null && r[k] !== '') return r[k]; return null; }

/* Local answer logic */
function localAnswer(q){
  const qq = q.toLowerCase();
  if(qq.includes('pul biber') || qq.includes('pulbiber')){
    const key = Object.keys(HAMMADDE_TOTALS).find(k=> k.toLowerCase().includes('pul') && k.toLowerCase().includes('biber')) || 'PULBIBER';
    const v = HAMMADDE_TOTALS[key];
    if(v!==undefined) return `AylÄ±k toplam PUL BIBER kullanÄ±mÄ±: ${fmt(v)} kg.`;
  }
  if((qq.includes('toplam') && qq.includes('hammadde')) || qq.includes('toplam hammadde')){
    if(HAMMADDE_TOTALS['GENEL TOPLAM']) return `AylÄ±k toplam kullanÄ±lan hammadde: ${fmt(HAMMADDE_TOTALS['GENEL TOPLAM'])} kg.`;
    let s=0; for(const v of Object.values(HAMMADDE_TOTALS)) s+=Number(v||0); return `AylÄ±k toplam kullanÄ±lan hammadde (hesaplanmÄ±ÅŸ): ${fmt(s)} kg.`;
  }
  if(qq.includes('en Ã§ok hangi hammadde') || (qq.includes('en Ã§ok') && qq.includes('hammadde'))){
    let best=null; for(const [k,v] of Object.entries(HAMMADDE_TOTALS)){ if(k.toUpperCase().includes('GENEL')) continue; if(!best||v>best[1]) best=[k,v]; } if(best) return `En Ã§ok kullanÄ±lan hammadde ${best[0]}, toplam ${fmt(best[1])} kg.`;
  }

  if(ROWS && ROWS.length>0){
    const firmNames = Array.from(new Set(ROWS.map(r=> (valOf(r,['FIRMA','Firma','FÄ°RMA'])||'').toString().trim()).filter(x=>x))).map(x=>x.toLowerCase());
    for(const fn of firmNames){
      if(q.toLowerCase().includes(fn)){
        const rowsF = ROWS.filter(r=> ((valOf(r,['FIRMA','Firma'])||'')+'').toString().trim().toLowerCase()===fn);
        const totalU = rowsF.reduce((s,x)=> s + Number(valOf(x,['MIKTAR','URETIM','ADET'])||0),0);
        const totalH = rowsF.reduce((s,x)=> s + Number(valOf(x,['KULLANILAN HAMMADDE MIKTARI','KULLANILAN HAMMADDE MÄ°KTARI','TOPLAM KULLANILAN HAMMADDE MIKTARI'])||0),0);
        return `${fn.toUpperCase()} iÃ§in toplam Ã¼retim ${fmt(totalU)} adet. KullanÄ±lan hammadde: ${fmt(totalH)} kg.`;
      }
    }

    const dm = q.match(/(\d{1,2})\s*(ekim|oct|october)/i);
    if(dm){
      const day = parseInt(dm[1],10);
      const rowsDay = ROWS.filter(r=>{
        const d = (valOf(r,['URETIM_TARIH','TARIH','TARÄ°H','DATE'])||'')+'';
        return d && (d.includes(day+'/') || d.includes(day+'.') || d.includes('-'+String(day).padStart(2,'0')+'-') || d.indexOf(' '+day+' ')!==-1);
      });
      if(rowsDay.length===0) return `Belirtilen tarih iÃ§in kayÄ±t bulunamadÄ±.`;
      if(q.toLowerCase().includes('Ã§alÄ±ÅŸan')||q.toLowerCase().includes('kisi')||q.toLowerCase().includes('kiÅŸi')){
        const totalK = rowsDay.reduce((s,x)=> s + Number(valOf(x,['KISI SAYISI','PERSONEL','CALISAN'])||0),0);
        return `${dm[0]} iÃ§in toplam Ã§alÄ±ÅŸan sayÄ±sÄ±: ${fmt(totalK)}.`;
      }
      let out = `${dm[0]} iÃ§in Ã¶zet:\n`;
      const map = {};
      for(const r of rowsDay){
        const prod = valOf(r,['STOK_ISMI','STOK_ADI','URUN']) || 'ÃœRÃœN';
        const firm = valOf(r,['FIRMA','Firma']) || 'FIRMA';
        const key = `${prod} | ${firm}`;
        if(!map[key]) map[key]={adet:0,hammadde:0,calisan:0,fire:0,sure:0};
        map[key].adet += Number(valOf(r,['MIKTAR','URETIM','ADET'])||0);
        map[key].hammadde += Number(valOf(r,['KULLANILAN HAMMADDE MIKTARI','KULLANILAN HAMMADDE MÄ°KTARI'])||0);
        map[key].calisan += Number(valOf(r,['KISI SAYISI','PERSONEL'])||0);
        map[key].fire += Number(valOf(r,['HAMMADDE FÄ°RE','OPP FÄ°RE','OMK FÄ°RE'])||0);
        map[key].sure += Number(valOf(r,['SURE','CALISMA SURESI','ADAM_SAAT'])||0);
      }
      for(const k of Object.keys(map)){ const s=map[k]; out += `â€¢ ${k}: adet ${fmt(s.adet)}, hammadde ${fmt(s.hammadde)} kg, kiÅŸi ${fmt(s.calisan)}, fire ${fmt(s.fire)}, sÃ¼re ${fmt(s.sure)} saat\n`; }
      return out;
    }

    if(q.toLowerCase().includes('en Ã§ok Ã¼retim') || (q.toLowerCase().includes('en Ã§ok') && q.toLowerCase().includes('Ã¼retim'))){
      const map = {}; for(const r of ROWS){ const f=valOf(r,['FIRMA','Firma'])||'UNKNOWN'; map[f]=(map[f]||0)+Number(valOf(r,['MIKTAR','URETIM','ADET'])||0); }
      const arr = Object.entries(map).sort((a,b)=> b[1]-a[1]); if(arr.length) return `En Ã§ok Ã¼retim yapÄ±lan firma ${arr[0][0]}, toplam ${fmt(arr[0][1])} adet.`;
    }
    if(q.toLowerCase().includes('en Ã§ok hammadde') || (q.toLowerCase().includes('en Ã§ok') && q.toLowerCase().includes('hammadde'))){
      const map = {}; for(const r of ROWS){ const f=valOf(r,['FIRMA','Firma'])||'UNKNOWN'; map[f]=(map[f]||0)+Number(valOf(r,['KULLANILAN HAMMADDE MIKTARI','KULLANILAN HAMMADDE MÄ°KTARI'])||0); }
      const arr = Object.entries(map).sort((a,b)=> b[1]-a[1]); if(arr.length) return `En Ã§ok hammadde kullanan firma ${arr[0][0]}, toplam ${fmt(arr[0][1])} kg.`;
    }
  }

  return null;
}

/* processQuery */
async function processQuery(q){
  document.getElementById('userText').innerText = 'Soru: ' + q;
  document.getElementById('resText').innerText = 'Ä°ÅŸleniyor...';
  const ans = localAnswer(q);
  if(ans){ document.getElementById('resText').innerText = ans; speakText(ans); return; }
  const suggestions = [];
  if(q.toLowerCase().includes('pul')||q.toLowerCase().includes('biber')) suggestions.push('Pul Biber miktarÄ±nÄ± mÄ± soruyorsunuz?');
  if(q.toLowerCase().includes('firma')) suggestions.push('Belirli firma adÄ± verir misiniz? (Ã¶r: SOFRA)');
  if(q.match(/\d{1,2}\s*ekim/i)) suggestions.push('Tarihi netleÅŸtirin (Ã¶rn: 5 Ekim).');
  let reply = 'Sorunuzu tam anlayamadÄ±m.';
  if(suggestions.length) reply += ' Belki ÅŸu sorulardan birini kastetmiÅŸ olabilirsiniz:\nâ€¢ ' + suggestions.join('\nâ€¢ ');
  reply += '\nLÃ¼tfen soruyu daha aÃ§Ä±k yazÄ±n veya Ã¶rnek verin.';
  document.getElementById('resText').innerText = reply;
  speakText(reply);
}

/* SpeechRecognition + mic animation */
let recognition=null, recognizing=false;
function setupRecognition(){
  const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!Rec){ transcript.innerText = 'TarayÄ±cÄ±nÄ±z ses tanÄ±mayÄ± desteklemiyor.'; return false; }
  recognition = new Rec(); recognition.lang='tr-TR'; recognition.interimResults=false; recognition.maxAlternatives=1;
  recognition.onstart = ()=>{ recognizing=true; ring.classList.add('on'); wave.style.opacity='1'; transcript.innerText='DINLENIYOR...'; };
  recognition.onresult = async (ev)=>{ recognizing=false; ring.classList.remove('on'); wave.style.opacity='0'; const txt = ev.results[0][0].transcript; transcript.innerText='SORDUN: '+txt; await processQuery(txt); };
  recognition.onerror = (e)=>{ recognizing=false; ring.classList.remove('on'); wave.style.opacity='0'; console.warn(e); if(e.error==='not-allowed'){ transcript.innerText='Mikrofon engellendi. LÃ¼tfen tarayÄ±cÄ± izinlerini kontrol edin.'; speakText('Mikrofon izni engellendi.'); } else { transcript.innerText='Ses algÄ±lama hatasÄ±.'; } };
  recognition.onend = ()=>{ recognizing=false; ring.classList.remove('on'); wave.style.opacity='0'; };
  return true;
}

async function ensureMicAndAnimate(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const src = ctx.createMediaStreamSource(stream);
      const analyser = ctx.createAnalyser(); analyser.fftSize=256; src.connect(analyser);
      const data = new Uint8Array(analyser.frequencyBinCount);
      function frame(){ analyser.getByteFrequencyData(data); const bars=document.querySelectorAll('.bar'); for(let i=0;i<bars.length;i++){ const v = data[i*2]||0; const h=Math.min(140,8+Math.round(v/6)); bars[i].style.height=h+'px'; } if(recognizing) requestAnimationFrame(frame); }
      frame();
    }catch(e){ console.warn('analyser',e); }
    return true;
  }catch(e){
    console.warn('getUserMedia',e);
    transcript.innerText='Mikrofon izni verilmedi veya tarayÄ±cÄ± desteklemiyor.';
    speakText('Mikrofon izni verilmedi. LÃ¼tfen tarayÄ±cÄ± izinlerini kontrol edin.');
    return false;
  }
}

/* events */
document.getElementById('micBtn').addEventListener('click', async ()=>{
  if(!setupRecognition()) return;
  const ok = await ensureMicAndAnimate();
  if(!ok) return;
  try{ recognition.start(); }catch(e){ console.warn(e); transcript.innerText='Dinleme baÅŸlatÄ±lamadÄ±.'; }
});

/* Paste modal handlers */
btnPaste.addEventListener('click', ()=>{ pasteModal.style.display='flex'; pasteModal.setAttribute('aria-hidden','false'); pasteArea.value=''; pasteArea.focus(); });
pasteCancel.addEventListener('click', ()=>{ pasteModal.style.display='none'; pasteModal.setAttribute('aria-hidden','true'); });
pasteSave.addEventListener('click', ()=>{
  try{
    const txt = pasteArea.value.trim();
    if(!txt){ alert('LÃ¼tfen JSON yapÄ±ÅŸtÄ±rÄ±n.'); return; }
    const parsed = JSON.parse(txt);
    if(!Array.isArray(parsed)){ alert('GeÃ§erli bir JSON dizi yapÄ±ÅŸtÄ±rÄ±n.'); return; }
    parsed.forEach(r=> ROWS.push(r));
    pasteModal.style.display='none'; pasteModal.setAttribute('aria-hidden','true');
    speakText('SatÄ±r verisi baÅŸarÄ±yla gÃ¶mÃ¼ldÃ¼. ArtÄ±k satÄ±r bazlÄ± sorgular Ã§alÄ±ÅŸacaktÄ±r.');
    document.getElementById('resText').innerText = 'SatÄ±r verisi gÃ¶mÃ¼ldÃ¼. ArtÄ±k firma/tarih bazlÄ± sorgulara cevap veriyorum.';
  }catch(e){ alert('JSON parse hatasÄ±: ' + e.message); }
});
btnClear.addEventListener('click', ()=>{ ROWS = []; speakText('SatÄ±r verisi temizlendi.'); document.getElementById('resText').innerText = 'SatÄ±r verisi temizlendi.'; });

/* chart button */
chartBtn.addEventListener('click', ()=>{
  const entries = Object.entries(HAMMADDE_TOTALS).filter(e=> !e[0].includes('GENEL')).sort((a,b)=> b[1]-a[1]).slice(0,20);
  const labels = entries.map(e=> e[0]), data = entries.map(e=> e[1]);
  const chartHtml = `<!doctype html><html><head><meta charset="utf-8"/><title>Hammadde GrafiÄŸi</title><script src="https://cdn.jsdelivr.net/npm/chart.js"></script></head><body style="background:#001222;color:#fff"><div style="padding:16px"><h3>En Ã‡ok KullanÄ±lan Hammadde (Top 20)</h3><canvas id="c" width="1000" height="500"></canvas></div><script>const ctx=document.getElementById('c').getContext('2d'); new Chart(ctx,{type:'bar',data:{labels:${JSON.stringify(labels)},datasets:[{label:'Kg',data:${JSON.stringify(data)},backgroundColor:'rgba(70,224,178,0.9)'}]},options:{scales:{y:{beginAtZero:true}}}});</script></body></html>`;
  const w = window.open(); w.document.write(chartHtml); w.document.close();
});

/* initial greeting */
window.addEventListener('load', ()=>{ speechSynthesis.getVoices(); setTimeout(()=>{ speakText('Merhaba, ben Sanita paketleme bilgi asistanÄ±yÄ±m. Bana dilediÄŸiniz soruyu sorabilirsiniz.'); },700); });
</script>
</body>
</html>
