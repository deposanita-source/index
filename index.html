<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Sanita Sesli Veri Asistanƒ±</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh; overflow-x: hidden;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
    }
    header {
      font-size: 1.8em; font-weight: bold;
      margin: 1em 0 0.5em 0; text-align: center;
    }
    #mic-button {
      margin-top: 1em;
      padding: 1em 2em;
      font-size: 1em;
      background-color: #00bcd4;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 10px #00bcd4;
    }
    #wave {
      margin-top: 1em;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle, #00bcd4 40%, transparent 70%);
      transition: transform 0.1s ease-out;
      display: none;
    }
    #response {
      margin-top: 2em; font-size: 1.2em;
      text-align: center; max-width: 90%;
      animation: fadeIn 2s ease-in-out;
      white-space: pre-line;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    #chart-container {
      width: 90%; max-width: 1000px;
      height: 400px; margin-top: 2em;
    }
    canvas {
      width: 100% !important; height: 100% !important;
      background-color: #fff; border-radius: 8px;
    }
  </style>
</head>
<body>
  <header>üéôÔ∏è Sanita Sesli Veri Asistanƒ±</header>
  <button id="mic-button">üé§ Soru Sor</button>
  <div id="wave"></div>
  <div id="response"></div>
  <div id="chart-container"><canvas id="chart"></canvas></div>
<script>
  const excelData = [
    {FIRMA:"SEKERCI", URUN:"PUL BIBER", URETIM:1200, HAMMADDE:"KIRMIZI BIBER", HAMMADDE_MIKTARI:300, TARIH:"10 Ekim", CALISAN:5},
    {FIRMA:"SEKERCI", URUN:"PUL BIBER", URETIM:800, HAMMADDE:"TUZ", HAMMADDE_MIKTARI:50, TARIH:"10 Ekim", CALISAN:5},
    {FIRMA:"SEKERCI", URUN:"LOKUM", URETIM:500, HAMMADDE:"NISASTA", HAMMADDE_MIKTARI:200, TARIH:"11 Ekim", CALISAN:4},
    {FIRMA:"PAKETLEME", URUN:"PUL BIBER", URETIM:1000, HAMMADDE:"KIRMIZI BIBER", HAMMADDE_MIKTARI:250, TARIH:"10 Ekim", CALISAN:3},
    {FIRMA:"PAKETLEME", URUN:"LOKUM", URETIM:600, HAMMADDE:"NISASTA", HAMMADDE_MIKTARI:180, TARIH:"11 Ekim", CALISAN:3}
  ];

  function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "tr-TR";
    speechSynthesis.speak(utterance);
  }

  window.onload = () => {
    speak("Merhaba, ben Sanita'nƒ±n sesli veri asistanƒ±yƒ±m. Size nasƒ±l yardƒ±mcƒ± olabilirim?");
  };

  document.getElementById("mic-button").onclick = () => {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "tr-TR";
    recognition.interimResults = false;
    recognition.continuous = false;

    recognition.start();
    speak("Dinliyorum, l√ºtfen sorunuzu sorun.");

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      const audioContext = new AudioContext();
      const source = audioContext.createMediaStreamSource(stream);
      const analyser = audioContext.createAnalyser();
      analyser.fftSize = 256;
      const dataArray = new Uint8Array(analyser.frequencyBinCount);
      source.connect(analyser);

      function animateWave() {
        analyser.getByteFrequencyData(dataArray);
        const volume = dataArray.reduce((a, b) => a + b) / dataArray.length;
        const scale = Math.min(2, Math.max(1, volume / 30));
        document.getElementById("wave").style.transform = `scale(${scale})`;
        requestAnimationFrame(animateWave);
      }

      document.getElementById("wave").style.display = "block";
      animateWave();
    });

    recognition.onresult = function (event) {
      const query = event.results[0][0].transcript.toLowerCase().trim();
      document.getElementById("response").innerText = "Soru: " + query;
      processQuery(query);
    };

    recognition.onerror = function () {
      document.getElementById("wave").style.display = "none";
      document.getElementById("wave").style.transform = "scale(1)";
    };

    recognition.onend = function () {
      document.getElementById("wave").style.display = "none";
      document.getElementById("wave").style.transform = "scale(1)";
    };
  };
</script>
function processQuery(query) {
  query = query.replace("sanita", "").trim();
   if (query.includes("detaylƒ± a√ßƒ±klama") || query.includes("openai") || query.includes("asistan")) {
  getOpenAIResponse(query);
  return;
}


  const sohbetYanƒ±tlarƒ± = {
    "nasƒ±lsƒ±n": "√áok iyiyim, sizin i√ßin buradayƒ±m.",
    "iyi misin": "Harikayƒ±m, size yardƒ±mcƒ± olmak i√ßin hazƒ±rƒ±m.",
    "burada mƒ±sƒ±n": "Evet, buradayƒ±m ve sizi dinliyorum.",
    "te≈üekk√ºrler": "Rica ederim, her zaman buradayƒ±m.",
    "merhaba": "Merhaba, nasƒ±l yardƒ±mcƒ± olabilirim?",
    "ho≈ü√ßa kal": "G√∂r√º≈ümek √ºzere, iyi √ßalƒ±≈ümalar."
  };

  for (let anahtar in sohbetYanƒ±tlarƒ±) {
    if (query.includes(anahtar)) {
      const mesaj = sohbetYanƒ±tlarƒ±[anahtar];
      document.getElementById("response").innerText += "\nYanƒ±t: " + mesaj;
      speak(mesaj);
      return;
    }
  }

  const olasiSorgular = [
    "Pul biber i√ßin toplam √ºretim ne kadar",
    "10 Ekim'de ne √ºretildi",
    "Paketlemede ka√ß ki≈üi √ßalƒ±≈ütƒ±",
    "Tarihe g√∂re √ºretim grafiƒüi g√∂ster",
    "Lokum i√ßin kullanƒ±lan toplam hammadde miktarƒ± nedir",
    "En √ßok √ºretim yapan firma hangisi",
    "√úr√ºnlere g√∂re ortalama √ºretim miktarƒ± nedir"
  ];

  let enYakin = olasiSorgular.find(s => query.split(" ").some(kelime => s.toLowerCase().includes(kelime)));
  if (!enYakin) {
    const mesaj = "Sorunuzu anlayamadƒ±m. L√ºtfen tekrar eder misiniz?";
    document.getElementById("response").innerText += "\nYanƒ±t: " + mesaj;
    speak(mesaj);
    return;
  }

  if (!query.includes("√ºretim") && !query.includes("grafik") && !query.includes("hammadde") && !query.includes("√ßalƒ±≈üan")) {
    const mesaj = `Bunu mu demek istediniz: "${enYakin}"? Evet mi, hayƒ±r mƒ±?`;
    document.getElementById("response").innerText += "\nYanƒ±t: " + mesaj;
    speak(mesaj);

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "tr-TR";
    recognition.interimResults = false;
    recognition.continuous = false;
    recognition.start();

    recognition.onresult = function (event) {
      const cevap = event.results[0][0].transcript.toLowerCase();
      if (cevap.includes("evet")) {
        processQuery(enYakin.toLowerCase());
      } else {
        speak("L√ºtfen sorunuzu tekrar edin.");
      }
    };
    return;
  }

  let filtered = [...excelData];
  const firma = query.includes("sekerci") ? "SEKERCI" :
                query.includes("paketleme") ? "PAKETLEME" : null;
  const urun = query.includes("pul") && query.includes("biber") ? "PUL BIBER" :
               query.includes("lokum") ? "LOKUM" : null;
  const tarihMatch = query.match(/\d{1,2}\s?[a-z√ßƒüƒ±√∂≈ü√º]{3,9}/i);
  const tarih = tarihMatch ? tarihMatch[0].toUpperCase() : null;

  if (firma) filtered = filtered.filter(r => r["FIRMA"] === firma);
  if (urun) filtered = filtered.filter(r => r["URUN"] === urun);
  if (tarih) filtered = filtered.filter(r => r["TARIH"].toUpperCase().includes(tarih));

  let toplamUretim = 0, toplamHammadde = 0, toplamCalisan = 0;
  filtered.forEach(row => {
    toplamUretim += row["URETIM"] || 0;
    toplamHammadde += row["HAMMADDE_MIKTARI"] || 0;
    toplamCalisan += row["CALISAN"] || 0;
  });

  let mesaj = "";
  if (query.includes("grafik")) {
    drawChart(filtered);
    mesaj = "Grafik g√∂steriliyor.";
  } else if (query.includes("√ßalƒ±≈üan")) {
    mesaj = `Toplam √ßalƒ±≈üan sayƒ±sƒ±: ${toplamCalisan}`;
  } else if (query.includes("ortalama")) {
    const ort = (toplamUretim / filtered.length).toFixed(2);
    mesaj = `Ortalama √ºretim miktarƒ±: ${ort} birim`;
  } else if (query.includes("hammadde")) {
    mesaj = `Toplam kullanƒ±lan hammadde miktarƒ±: ${toplamHammadde} kg`;
  } else {
    mesaj = `Toplam √ºretim: ${toplamUretim} birim. Toplam hammadde: ${toplamHammadde} kg. √áalƒ±≈üan sayƒ±sƒ±: ${toplamCalisan}`;
  }

  document.getElementById("response").innerText += "\nYanƒ±t: " + mesaj;
  speak(mesaj);
}

function drawChart(data) {
  const ctx = document.getElementById("chart").getContext("2d");
  if (window.barChart) window.barChart.destroy();

  const grouped = {};
  data.forEach(row => {
    if (!grouped[row.TARIH]) grouped[row.TARIH] = 0;
    grouped[row.TARIH] += row.URETIM;
  });

  const labels = Object.keys(grouped);
  const values = Object.values(grouped);

  window.barChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "√úretim Miktarƒ±",
        data: values,
        backgroundColor: "#00bcd4"
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}
</script>
</body>
</html>
const OPENAI_API_KEY = "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"; // Buraya kendi OpenAI anahtarƒ±nƒ± ekle

async function getOpenAIResponse(prompt) {
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${OPENAI_API_KEY}`
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }],
      temperature: 0.7
    })
  });

  const data = await response.json();
  const reply = data.choices?.[0]?.message?.content || "Yanƒ±t alƒ±namadƒ±.";
  document.getElementById("response").innerText += "\nYanƒ±t: " + reply;
  speak(reply);
}
