<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SANÄ°TA YAPAY ZEKA ASISTANI</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');
  :root{
    --bg1:#00121a; --bg2:#021428; --neon:#00f5d4; --neon2:#00b4d8; --neon-white: #eaffff;
    --card:rgba(255,255,255,0.03); --muted:rgba(255,255,255,0.75);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Poppins,system-ui,Segoe UI,Arial;background:radial-gradient(800px 400px at 10% 10%, rgba(0,20,30,0.6), transparent), linear-gradient(180deg,var(--bg1),var(--bg2));color:white;-webkit-font-smoothing:antialiased;}
  .bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
  .orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:0.14;mix-blend-mode:screen}
  .orb.o1{width:820px;height:820px;left:-20%;top:-30%;background:linear-gradient(90deg,#003a6b,#005f8a)}
  .orb.o2{width:600px;height:600px;right:-10%;bottom:-10%;background:linear-gradient(90deg,#002b59,#004e73);opacity:0.12}
  .app{max-width:520px;margin:0 auto;padding:14px;min-height:100vh;display:flex;flex-direction:column;gap:12px;position:relative;z-index:2;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--neon2),var(--neon));display:grid;place-items:center;color:#012;font-weight:800;box-shadow:0 8px 40px rgba(0,245,212,0.08)}
  h1{margin:0;font-size:1.05rem;color:var(--neon);text-shadow:0 0 14px rgba(0,245,212,0.08)}
  .sub{font-size:0.85rem;color:var(--muted)}
  main.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:14px;padding:12px;box-shadow:0 10px 40px rgba(0,0,0,0.35);display:flex;flex-direction:column;gap:12px;}
  .transcript{display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
  .pulse{width:12px;height:12px;border-radius:4px;background:linear-gradient(180deg,var(--neon),var(--neon2));box-shadow:0 10px 28px rgba(0,200,170,0.09);flex:0 0 12px}
  .flow{display:block;overflow:hidden;flex:1}
  .flow .txt{display:block;color:var(--neon-white);font-weight:700} /* NEON WHITE TRANSCRIPT */
  .bubbles{display:flex;flex-direction:column;gap:10px;max-height:46vh;overflow:auto;padding:6px;margin-top:6px}
  .bubble{max-width:88%;padding:12px 14px;border-radius:14px;display:inline-block;position:relative;word-break:break-word;box-shadow:0 6px 30px rgba(1,10,20,0.4);}
  .bubble.user{background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));align-self:flex-end;border-bottom-right-radius:6px;color:#fff}
  .bubble.ai{background:linear-gradient(90deg, rgba(0,245,212,0.06), rgba(0,180,216,0.03));align-self:flex-start;border-bottom-left-radius:6px;color:#001}
  .emoji{margin-right:8px;font-size:18px;display:inline-block;vertical-align:middle}
  .meta{margin-top:8px;font-size:11px;color:rgba(0,0,0,0.35);font-weight:700;padding-top:6px}
  .mic-row{display:flex;align-items:center;gap:12px;justify-content:center;margin-top:6px}
  .mic{width:92px;height:92px;border-radius:999px;background:linear-gradient(145deg,var(--neon),var(--neon2));display:grid;place-items:center;font-size:36px;cursor:pointer;border:2px solid rgba(255,255,255,0.06);box-shadow:0 14px 48px rgba(0,180,216,0.12)}
  .mic.record{transform:scale(1.04);box-shadow:0 20px 80px rgba(0,245,212,0.16);animation:micGlow 1.2s infinite alternate}
  @keyframes micGlow{from{filter:drop-shadow(0 0 6px rgba(0,245,212,0.08))}to{filter:drop-shadow(0 0 28px rgba(0,180,216,0.18))}}
  .controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:6px}
  .btn{padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.03),transparent);border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:700}
  .cats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px}
  @media(max-width:520px){.app{padding:10px}.cats{grid-template-columns:1fr}}
  .cat{padding:10px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);cursor:default}
  .cat .title{font-weight:700;color:var(--neon);display:flex;align-items:center;gap:8px}
  .qs{margin-top:8px;display:flex;flex-direction:column;gap:8px;max-height:240px;overflow:auto;padding-right:6px}
  .qitem{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:700;color:var(--muted);display:flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
  .qitem:hover{background:linear-gradient(90deg, rgba(0,245,212,0.03), rgba(0,180,216,0.02));color:var(--neon)}
  footer{display:flex;align-items:center;justify-content:center;padding:10px;margin-top:6px}
  .copyright{padding:6px 12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);box-shadow:0 6px 24px rgba(0,0,0,0.3);font-weight:700;color:var(--neon);font-size:13px}
</style>
</head>
<body>
<div class="bg" aria-hidden><div class="orb o1"></div><div class="orb o2"></div></div>

<div class="app" role="application" aria-label="Sanita Yapay Zeka Asistani">
  <header>
    <div style="display:flex;gap:12px;align-items:center;">
      <div class="logo">SN</div>
      <div><h1>SANÄ°TA YAPAY ZEKA ASISTANI</h1><div class="sub">DilediÄŸini sorabilirsin â€” sesle veya dokunarak.</div></div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <select id="voiceSelect" class="btn" aria-label="Ses tercihi"><option value="female">ğŸ‘© KadÄ±n (Ã¶nerilen)</option><option value="male">ğŸ‘¨ Erkek</option></select>
      <button id="download" class="btn">â¬‡ï¸ Ä°ndir</button>
    </div>
  </header>

  <main class="card" role="main">
    <div class="transcript" aria-live="polite">
      <div class="pulse" aria-hidden></div>
      <div class="flow"><span class="txt" id="flowText">---</span></div>
    </div>

    <div class="bubbles" id="bubbles" aria-live="polite"></div>

    <div class="mic-row">
      <div id="mic" class="mic" title="Mikrofonu baÅŸlat">ğŸ¤</div>
    </div>

    <div class="controls" style="justify-content:space-between;align-items:center">
      <button id="clear" class="btn">ğŸ§¹ Temizle</button>
      <div style="font-size:13px;color:var(--muted);font-weight:700">Kategoriler her zaman sabit - Ã¶rnek sorularÄ± kullan.</div>
    </div>

    <div class="cats" id="cats" aria-hidden>
      <div class="cat"><div class="title">ğŸ‘¥ Personel</div>
        <div class="qs"><div class="qitem" data-q="kaÃ§ kiÅŸi Ã§alÄ±ÅŸtÄ± bu ay?">ğŸ‘· KaÃ§ kiÅŸi Ã§alÄ±ÅŸtÄ± bu ay?</div><div class="qitem" data-q="1 ekimde kaÃ§ kiÅŸi Ã§alÄ±ÅŸtÄ±?">ğŸ“… 01.10.2025'te kaÃ§ kiÅŸi Ã§alÄ±ÅŸtÄ±?</div><div class="qitem" data-q="aylÄ±k toplam kiÅŸi sayÄ±sÄ± nedir?">ğŸ“Š AylÄ±k toplam kiÅŸi sayÄ±sÄ± nedir?</div></div>
      </div>
      <div class="cat"><div class="title">ğŸ­ Ãœretim</div>
        <div class="qs"><div class="qitem" data-q="toplam Ã¼retim miktarÄ± nedir?">ğŸ“¦ Toplam Ã¼retim miktarÄ± nedir?</div><div class="qitem" data-q="sofra Ã¼retim miktarÄ± kaÃ§ adet?">ğŸ·ï¸ SOFRA Ã¼retim miktarÄ± kaÃ§ adet?</div><div class="qitem" data-q="en fazla Ã¼retim yapan firma hangisi?">ğŸ” En fazla Ã¼retim yapan firma hangisi?</div></div>
      </div>
      <div class="cat"><div class="title">ğŸ§‚ Hammadde</div>
        <div class="qs"><div class="qitem" data-q="en Ã§ok hangi hammadde kullanÄ±ldÄ±?">ğŸ” En Ã§ok hangi hammadde kullanÄ±ldÄ±?</div><div class="qitem" data-q="pul biberden kaÃ§ kilo kullanÄ±ldÄ±?">ğŸŒ¶ Pul Biberden kaÃ§ kilo kullanÄ±ldÄ±?</div><div class="qitem" data-q="toplam kullanÄ±lan hammadde miktarÄ± nedir?">ğŸ¥£ Toplam kullanÄ±lan hammadde miktarÄ± nedir?</div></div>
      </div>
      <div class="cat"><div class="title">ğŸ”¥ Fire</div>
        <div class="qs"><div class="qitem" data-q="toplam hammadde fire miktarÄ± kaÃ§ kg?">âš ï¸ Toplam hammadde fire miktarÄ± kaÃ§ kg?</div><div class="qitem" data-q="omk ve opp fire toplamÄ± nedir?">ğŸ§¾ OMK ve OPP fire toplamÄ± nedir?</div><div class="qitem" data-q="fire oranÄ± yÃ¼zde kaÃ§?">ğŸ“‰ Fire oranÄ± yÃ¼zde kaÃ§?</div></div>
      </div>
    </div>
  </main>

  <footer><div class="copyright">Â© 2025 Yapay Zeka GeliÅŸtiricisi: Bilal TektaÅŸ ğŸ¤–</div></footer>
</div>

<script>
// ================= embedded datasets =================
// HAMMADDELER (hammadde tÃ¼rÃ¼ -> kg)
const HAMMADDELER = {
"Ã‡AM FISTIÄI":160.00,"YENÄ°BAHAR":920.05,"PULBÄ°BER":20107.24,"TÃœM BÄ°BER":299.00,"DEFNE YAPRAÄI":204.46,
"KEKÄ°K":2552.74,"Ä°SOT":4130.77,"ANASON":559.52,"HÄ°NDÄ°STAN CEVÄ°ZÄ°":4154.01,"IHLAMUR":102.00,"MAVÄ° HAÅHAÅ":260.00,
"Ã‡EÅNÄ° MILD SEASONING":120.00,"VANÄ°LÄ°N ÅEKERLÄ°":310.00,"SUMAK":1666.49,"BÄ°BERÄ°YE":1436.54,"MÄ°X MARINATION":120.00,
"TUZOT":120.00,"TARÃ‡IN":2763.43,"KÄ°MYON":4475.46,"KÃ–RÄ°":1670.06,"LÄ°MON TUZU":9441.80,"KARABÄ°BER":3020.10,
"TOZ BÄ°BER":14818.43,"NÄ°ÅASTA BUÄDAY":100.00,"MAHLEP":38.80,"KARBONAT":342.00,"Ã‡Ã–REKOTU":30.00,"GALETA UNU":8770.10,
"KUÅ ÃœZÃœMÃœ":1620.00,"BEYAZ HAÅHAÅ":10.00,"SARIMSAK":971.80,"NÄ°ÅASTA MISIR":500.00,"ZERDEÃ‡AL":743.00,"PÄ°ZZA SPÄ°CE MÄ°X":25.20,
"KEBAP SPICE MÄ°X":19.20,"NANE":3869.95,"MAYDANOZ":496.80,"CHÄ°CKEN SEASONING MÄ°X":19.20,"SPÄ°CE MIX":19.20,"BAHARAT KARIÅIMI":26.88,
"FESLEÄEN":534.90,"SUSAM":2721.90,"ZENCEFÄ°L":196.10,"KÄ°ÅNÄ°Å":55.68,"DEREOTU":26.06,"SOÄAN":20.00,"BAMYA KURUSU":5.00,
"YER FISTIÄI":60.10,"SHAWARMA Ã‡EÅNÄ°SÄ°":13.50,"MASALA Ã‡EÅNÄ°SÄ°":12.00,"DENÄ°Z ÃœRÃœNLERÄ° Ã‡EÅNÄ°SÄ°":13.50,"YEMEKLÄ°K TUZ":30.00,
"TAVUK Ã‡EÅNÄ°SÄ°":10.50,"BARBEKÃœ Ã‡EÅNÄ°SÄ°":15.00,"ET Ã‡EÅNÄ°SÄ°":15.00,"MISIR UNU":1850.30,"HÄ°MALAYA TUZU":1033.20,"KAJUN Ã‡EÅNÄ°SÄ°":12.00,
"MÄ°X 7 TÃœRLÃœ":215.20,"DENÄ°Z TUZU":390.72,"MUSKAT":98.40,"SALATA Ã‡EÅNÄ°":8.10,"PATATES Ã‡EÅNÄ°":18.00,"MAKARNA Ã‡EÅNÄ°":8.10,
"KABARTMA TOZU":10.00,"KAYA TUZU":288.00,"BALIK MÄ°X":43.20,"PÄ°RÄ°NÃ‡ UNU":100.00,"SOS BAHARATI":50.00,"BUÄDAY NÄ°ÅASTA":100.00,
"AKBÄ°BER":20.00
};

// FIRMALAR (firma -> {uret:adet, hammadde:kg})
const DATA = {
  aylik:{kisi:418.00, calisma_saat:951.75, uretim_adet:211991.00, toplam_hammadde:99126.68, hammadde_fire:5.48, omk_fire:28.00, opp_fire:15.80},
  firmalar:{
"SOFRA":{uret:31477,hammadde:29055},"KERVAN":{uret:764,hammadde:764},"RECEP CAN":{uret:1952,hammadde:4760},
"EVERGREEN":{uret:48122,hammadde:9921},"BEDÄ°R TEDARÄ°K":{uret:1964,hammadde:1702},"Ã–NEN GIDA":{uret:100,hammadde:100},
"Ã‡ELÄ°K NATUREL":{uret:100,hammadde:100},"ÅEKERCÄ°":{uret:10484,hammadde:11828},"GENÄ°M GIDA":{uret:5173,hammadde:4761},
"AKAR FOOD":{uret:11454,hammadde:1170},"MAUN GIDA":{uret:550,hammadde:550},"VENÃœS":{uret:3660,hammadde:2579},
"ANADOLU ÃœNÄ°VERSÄ°TESÄ°":{uret:340,hammadde:310},"EKOL FOOD":{uret:864,hammadde:723},"SANITA EVERGREEN":{uret:672,hammadde:336},
"MESA":{uret:70990,hammadde:9804},"CASH&CARRY":{uret:13522,hammadde:15308},"BORTAR":{uret:797,hammadde:704},
"VKS":{uret:1794,hammadde:1002},"HABÄ°P ALBAYRAK":{uret:1086,hammadde:1008},"FATSAT":{uret:320,hammadde:320},
"NIOLES":{uret:750,hammadde:341},"SALEH":{uret:4224,hammadde:1024},"KIRÃ‡Ä°Ã‡EÄÄ°":{uret:50,hammadde:50},
"MAYA CATERÄ°NG":{uret:42,hammadde:36},"T DÃ–NER":{uret:500,hammadde:50},"FRESH FOOD":{uret:50,hammadde:50},
"EGES YEMEK":{uret:190,hammadde:190}
  }
};

// ========= pronunciation fixes & number -> words conversion =========
const PRONUNCIATION = {
  'pulbiber':'Pul Biber',
  'Ã§amfÄ±stÄ±ÄŸÄ±':'Ã‡am FÄ±stÄ±ÄŸÄ±',
  'Ã§am fÄ±stÄ±ÄŸÄ±':'Ã‡am FÄ±stÄ±ÄŸÄ±',
  'yenibahar':'Yeni Bahar',
  'yeni bahar':'Yeni Bahar',
  'toz biber':'Toz Biber',
  'limon tuzu':'Limon Tuzu'
};

function numberToTurkishWords(n){
  if(n===null || n===undefined) return '';
  let s = String(n).replace(/\s/g,'').replace(/\./g,'').replace(',', '.');
  if(isNaN(Number(s))) return String(n);
  let num = Number(s);
  let intPart = Math.floor(Math.abs(num));
  let fracPart = Math.round((Math.abs(num) - intPart) * 100);
  const ones = ['sÄ±fÄ±r','bir','iki','Ã¼Ã§','dÃ¶rt','beÅŸ','altÄ±','yedi','sekiz','dokuz'];
  const tens = ['','on','yirmi','otuz','kÄ±rk','elli','altmÄ±ÅŸ','yetmiÅŸ','seksen','doksan'];
  function intToWords(x){
    if(x===0) return 'sÄ±fÄ±r';
    let parts=[];
    if(x>=1000000){
      const m = Math.floor(x/1000000);
      parts.push( (m>1? intToWords(m)+' ':'') + 'milyon' );
      x = x%1000000;
    }
    if(x>=1000){
      const k = Math.floor(x/1000);
      if(k===1) parts.push('bin'); else parts.push(intToWords(k)+' bin');
      x = x%1000;
    }
    if(x>=100){
      const h = Math.floor(x/100);
      if(h===1) parts.push('yÃ¼z'); else parts.push(ones[h]+' yÃ¼z');
      x = x%100;
    }
    if(x>=10){
      const t = Math.floor(x/10);
      parts.push(tens[t]);
      x = x%10;
    }
    if(x>0){
      parts.push(ones[x]);
    }
    return parts.join(' ').replace(/\s+/g,' ').trim();
  }
  let sign = num<0? 'eksi ' : '';
  let intWords = intToWords(intPart);
  if(fracPart>0){
    let fracWords = fracPart.toString().padStart(2,'0').split('').map(d=>['sÄ±fÄ±r','bir','iki','Ã¼Ã§','dÃ¶rt','beÅŸ','altÄ±','yedi','sekiz','dokuz'][Number(d)]).join(' ');
    return (sign + intWords + ' virgÃ¼l ' + fracWords).replace(/\s+/g,' ').trim();
  } else {
    return (sign + intWords).replace(/\s+/g,' ').trim();
  }
}

function selectVoice(pref){
  const voices = speechSynthesis.getVoices();
  if(!voices || voices.length===0) return null;
  let candidate = voices.find(v=>/tr-?tr|turkish/i.test(v.lang) && /female|woman|kadÄ±n|ayÅŸe|fatma/i.test(v.name.toLowerCase()));
  if(!candidate) candidate = voices.find(v=>/tr-?tr|turkish/i.test(v.lang));
  if(!candidate && pref==='female') candidate = voices.find(v=>/female|woman|kadÄ±n/i.test(v.name.toLowerCase()));
  if(!candidate && pref==='male') candidate = voices.find(v=>/male|man|erkek/i.test(v.name.toLowerCase()));
  if(!candidate) candidate = voices[0];
  return candidate;
}

function speakText(raw, preferGender='female'){
  let text = String(raw);
  Object.keys(PRONUNCIATION).forEach(k=>{
    const re = new RegExp('\\b'+k+'\\b','gi');
    text = text.replace(re, PRONUNCIATION[k]);
  });
  text = text.replace(/(\d{1,3}(?:[\.\,]\d{3})*(?:[\.,]\d+)?)/g, function(m){
    let normalized = m.replace(/\./g,'').replace(',', '.');
    if(!isNaN(Number(normalized))){
      return numberToTurkishWords(normalized);
    }
    return m;
  });
  const u = new SpeechSynthesisUtterance(text);
  u.lang='tr-TR'; u.rate = 0.95; u.pitch = 1.0;
  const v = selectVoice(preferGender);
  if(v) u.voice = v;
  speechSynthesis.cancel(); speechSynthesis.speak(u);
}

function fmt(n){ return (typeof n==='number')? n.toLocaleString('tr-TR') : n; }
function appendBubble(txt, who='ai', emoji='ğŸ¤–'){
  const bubbles = document.getElementById('bubbles');
  const el = document.createElement('div'); el.className = 'bubble '+(who==='user'?'user':'ai');
  el.innerHTML = `<span class="emoji">${emoji}</span><span class="txt">${txt}</span>`;
  bubbles.appendChild(el); bubbles.scrollTop = bubbles.scrollHeight;
  return el;
}

function maxHammadde(){
  const entries = Object.entries(HAMMADDELER);
  let max = entries[0];
  for(const e of entries){ if(e[1] > max[1]) max = e; }
  return max;
}
function enYuksek(key){
  return Object.entries(DATA.firmalar).map(([k,v])=>({firma:k,val:v[key]})).sort((a,b)=>b.val-a.val);
}

function answerFor(text){
  const t = text.toLowerCase();
  if(/en (Ã§ok|cok|fazla) hangi hammadde/.test(t)) {
    const m = maxHammadde();
    const spoken = `${m[0]} en Ã§ok kullanÄ±lan hammadde: ${fmt(m[1])} kg.`;
    return {display: `${m[0]} â€” ${fmt(m[1])} kg`, speak: spoken};
  }
  for(const name of Object.keys(HAMMADDELER)){
    const key = name.toLowerCase();
    if(t.includes(key) || t.replace(/\s+/g,'').includes(key.replace(/\s+/g,''))){
      const val = HAMMADDELER[name];
      return {display: `${name}: ${fmt(val)} kg`, speak: `${name} toplam kullanÄ±m ${fmt(val)} kilogramdÄ±r.`};
    }
  }
  for(const fname of Object.keys(DATA.firmalar)){
    const key = fname.toLowerCase();
    if(t.includes(key) || t.replace(/\s+/g,'').includes(key.replace(/\s+/g,''))){
      const info = DATA.firmalar[fname];
      if(/Ã¼retim|kaÃ§ adet|adet|Ã¼retim miktarÄ±/.test(t)) return {display: `${fname} Ã¼retim: ${fmt(info.uret)} adet`, speak: `${fname} firmasÄ±nÄ±n Ã¼retim miktarÄ± ${numberToTurkishWords(info.uret)} adettir.`};
      if(/hammadde|kaÃ§ kg|kg|kullandÄ±/.test(t)) return {display: `${fname}: ${fmt(info.hammadde)} kg`, speak: `${fname} firmasÄ±nÄ±n kullandÄ±ÄŸÄ± toplam hammadde ${numberToTurkishWords(info.hammadde)} kilogramdÄ±r.`};
      if(/ortalama|adet baÅŸÄ±|kiÅŸi baÅŸÄ±/.test(t)) return {display: `${fname} ort hammadde/adet: ${(info.hammadde/(info.uret||1)).toFixed(4)} kg/adet`, speak: `${fname} iÃ§in ortalama hammadde birim baÅŸÄ±na ${(info.hammadde/(info.uret||1)).toFixed(4)} kilogramdÄ±r.`};
    }
  }
  if(/toplam Ã¼retim|genel toplam Ã¼retim/.test(t)) return {display:`Toplam Ã¼retim: ${fmt(DATA.aylik.uretim_adet)} adet`, speak: `Toplam Ã¼retim ${numberToTurkishWords(DATA.aylik.uretim_adet)} adettir.`};
  if(/toplam (kullanÄ±lan )?hammadde|toplam hammadde/.test(t)) return {display:`Toplam kullanÄ±lan hammadde: ${fmt(DATA.aylik.toplam_hammadde)} kg`, speak: `Toplam kullanÄ±lan hammadde ${numberToTurkishWords(DATA.aylik.toplam_hammadde)} kilogramdÄ±r.`};
  if(/kaÃ§ kiÅŸi|kiÅŸi sayÄ±sÄ±|personel|kaÃ§ Ã§alÄ±ÅŸan/.test(t)) return {display:`Toplam kiÅŸi: ${fmt(DATA.aylik.kisi)}`, speak: `Toplam ${numberToTurkishWords(DATA.aylik.kisi)} kiÅŸi Ã§alÄ±ÅŸtÄ±.`};
  if(/Ã§alÄ±ÅŸma sÃ¼resi|Ã§alÄ±ÅŸma saati|toplam saat/.test(t)) return {display:`Toplam Ã§alÄ±ÅŸma sÃ¼resi: ${fmt(DATA.aylik.calisma_saat)} saat`, speak: `Toplam Ã§alÄ±ÅŸma sÃ¼resi ${numberToTurkishWords(DATA.aylik.calisma_saat)} saattir.`};
  if(/hammadde fire|omk|opp|toplam fire/.test(t)) return {display:`Fireler: hammadde ${fmt(DATA.aylik.hammadde_fire)} kg, OMK ${fmt(DATA.aylik.omk_fire)} kg, OPP ${fmt(DATA.aylik.opp_fire)} kg`, speak: `Hammadde fire ${numberToTurkishWords(DATA.aylik.hammadde_fire)} kilogram, OMK fire ${numberToTurkishWords(DATA.aylik.omk_fire)} kilogram, OPP fire ${numberToTurkishWords(DATA.aylik.opp_fire)} kilogram.`};
  if(/en verimli|verimlilik/.test(t)){
    const arr = Object.entries(DATA.firmalar).map(([k,v])=>({firma:k,ratio:v.uret/(v.hammadde||1)})).sort((a,b)=>b.ratio-a.ratio);
    const top3 = arr.slice(0,3).map(x=> `${x.firma} (${x.ratio.toFixed(2)})`).join(', ');
    return {display:`En verimli 3: ${top3}`, speak:`En verimli Ã¼Ã§ firma: ${top3}.`};
  }
  if(/merhaba|selam|gÃ¼naydÄ±n|iyi gÃ¼nler/.test(t)) return {display: 'Merhaba! NasÄ±lsÄ±nÄ±z?', speak: 'Merhaba! NasÄ±lsÄ±nÄ±z?'};
  if(/nasÄ±lsÄ±n|nasilsin/.test(t)) return {display:'Ä°yiyim, teÅŸekkÃ¼rler! Siz nasÄ±lsÄ±nÄ±z?', speak:'Ä°yiyim, teÅŸekkÃ¼rler! Siz nasÄ±lsÄ±nÄ±z?'};
  if(/teÅŸekkÃ¼r|tesekkur/.test(t)) return {display:'Rica ederim ğŸ™‚', speak:'Rica ederim.'};
  if(/gÃ¶rÃ¼ÅŸÃ¼rÃ¼z|bye|hoÅŸÃ§a kal|hosca kal/.test(t)) return {display:'GÃ¶rÃ¼ÅŸmek Ã¼zere ğŸ‘‹', speak:'GÃ¶rÃ¼ÅŸmek Ã¼zere.'};
  return null;
}

document.querySelectorAll('.qitem').forEach(q=> q.addEventListener('click', ()=> {
  const qtext = q.dataset.q;
  document.getElementById('flowText').textContent = q.textContent;
  appendBubble(q.textContent,'user','ğŸ—£ï¸');
  setTimeout(()=> { respondTo(q.textContent); }, 220);
}));

const micBtn = document.getElementById('mic');
let recognition = null;
if('SpeechRecognition' in window || 'webkitSpeechRecognition' in window){
  const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new Rec(); recognition.lang='tr-TR'; recognition.interimResults=false; recognition.maxAlternatives=1;
  recognition.onresult = (e)=>{
    const text = e.results[0][0].transcript;
    document.getElementById('flowText').textContent = text;
    appendBubble(text,'user','ğŸ—£ï¸');
    respondTo(text);
    micBtn.classList.remove('record');
  };
  recognition.onerror = ()=>{ document.getElementById('flowText').textContent = 'Mikrofon hatasÄ±. LÃ¼tfen tekrar deneyin.'; micBtn.classList.remove('record'); };
} else {
  document.getElementById('flowText').textContent = 'TarayÄ±cÄ±nÄ±z konuÅŸma tanÄ±mayÄ± desteklemiyor. Ã–rnek sorularÄ± kullanÄ±n.';
  micBtn.style.opacity = 0.7;
}

micBtn.addEventListener('click', ()=>{
  if(recognition){
    try{ recognition.start(); document.getElementById('flowText').textContent='Dinleniyor... KonuÅŸun.'; micBtn.classList.add('record'); } catch(e){ recognition.stop(); micBtn.classList.remove('record'); }
  }
});

function respondTo(text){
  const resp = answerFor(text);
  if(!resp){
    const fallback = 'ÃœzgÃ¼nÃ¼m, bu sorunun cevabÄ± veri setinde aÃ§Ä±kÃ§a bulunmuyor.';
    appendBubble(fallback,'ai','ğŸ¤–');
    speakText(fallback, document.getElementById('voiceSelect').value);
    return;
  }
  appendBubble(resp.display,'ai','ğŸ¤–');
  document.getElementById('flowText').textContent = resp.display;
  speakText(resp.speak || resp.display, document.getElementById('voiceSelect').value);
}

window.addEventListener('load', ()=>{
  const greeting = 'HoÅŸ geldiniz! Ben Sanita Yapay Zeka AsistanÄ±. Size nasÄ±l yardÄ±mcÄ± olabilirim?';
  appendBubble(greeting,'ai','ğŸ¤–');
  document.getElementById('flowText').textContent = greeting;
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine'; o.frequency.value = 880; g.gain.value = 0.0015; o.connect(g); g.connect(ctx.destination);
    o.start(); setTimeout(()=>{ o.stop(); ctx.close(); }, 120);
  }catch(e){}
  setTimeout(()=>{
    try{ speakText(greeting, 'female'); }
    catch(e){ console.warn('TTS failed', e); }
  },300);
});

document.getElementById('clear').addEventListener('click', ()=>{ document.getElementById('bubbles').innerHTML=''; document.getElementById('flowText').textContent=''; });

document.getElementById('download').addEventListener('click', ()=>{
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'sanita-assistant-final.html'; document.body.appendChild(a); a.click(); a.remove();
});
</script>
</body>
</html>
