
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sanita â€” Mobil AI Asistan (GÃ¼ncel Hammaddeler)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');
  :root{
    --bg1:#00121a; --bg2:#021428; --neon:#00f5d4; --neon2:#00b4d8; --glass:rgba(255,255,255,0.03);
    --muted:rgba(255,255,255,0.75);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Poppins,system-ui,Segoe UI,Arial;background:radial-gradient(800px 400px at 10% 10%, rgba(0,20,30,0.6), transparent), linear-gradient(180deg,var(--bg1),var(--bg2));color:white;-webkit-font-smoothing:antialiased;}
  .app{max-width:460px;margin:0 auto;padding:14px;min-height:100vh;display:flex;flex-direction:column;gap:12px;position:relative;z-index:2;}
  /* animated background */
  .bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
  .orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:0.14;mix-blend-mode:screen}
  .orb.o1{width:820px;height:820px;left:-20%;top:-30%;background:linear-gradient(90deg,#003a6b,#005f8a)}
  .orb.o2{width:600px;height:600px;right:-10%;bottom:-10%;background:linear-gradient(90deg,#002b59,#004e73);opacity:0.12}
  header{display:flex;align-items:center;gap:12px;z-index:2}
  .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--neon2),var(--neon));display:grid;place-items:center;color:#012;font-weight:700;box-shadow:0 8px 40px rgba(0,245,212,0.08)}
  h1{margin:0;font-size:1.05rem;color:var(--neon);text-shadow:0 0 14px rgba(0,245,212,0.08)}
  .subtitle{font-size:0.85rem;color:var(--muted);margin-top:4px}
  /* main chat area */
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:14px;padding:12px;box-shadow:0 10px 40px rgba(0,0,0,0.35);}
  .transcript{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);overflow:hidden}
  .pulse{width:12px;height:12px;border-radius:4px;background:linear-gradient(180deg,var(--neon),var(--neon2));box-shadow:0 10px 28px rgba(0,200,170,0.09);flex:0 0 12px}
  .flow{white-space:nowrap;display:block;overflow:hidden;flex:1}
  .flow .txt{display:inline-block;padding-left:100%;animation:flowText 10s linear infinite}
  @keyframes flowText{0%{transform:translateX(0)}50%{transform:translateX(-40%)}100%{transform:translateX(0)}}
  .bubbles{display:flex;flex-direction:column;gap:10px;max-height:56vh;overflow:auto;padding:6px;margin-top:8px}
  .bubble{max-width:84%;padding:12px 14px;border-radius:14px;display:inline-block;position:relative;word-break:break-word;box-shadow:0 6px 30px rgba(1,10,20,0.4);animation:pop .28s ease both}
  @keyframes pop{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
  .bubble.user{background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));align-self:flex-end;border-bottom-right-radius:6px}
  .bubble.ai{background:linear-gradient(90deg, rgba(0,245,212,0.08), rgba(0,180,216,0.03));align-self:flex-start;border-bottom-left-radius:6px;color:#012}
  .bubble .emoji{margin-right:8px;font-size:18px;display:inline-block;vertical-align:middle}
  .meta{margin-top:8px;font-size:11px;color:rgba(0,0,0,0.35);font-weight:700;padding-top:6px}
  /* mic row */
  .mic-row{display:flex;align-items:center;gap:12px;justify-content:center;margin-top:6px}
  .mic{width:92px;height:92px;border-radius:999px;background:linear-gradient(145deg,var(--neon),var(--neon2));display:grid;place-items:center;font-size:36px;cursor:pointer;border:2px solid rgba(255,255,255,0.06);box-shadow:0 14px 48px rgba(0,180,216,0.12)}
  .mic.record{transform:scale(1.04);box-shadow:0 20px 80px rgba(0,245,212,0.16);animation:micGlow 1.2s infinite alternate}
  @keyframes micGlow{from{filter:drop-shadow(0 0 6px rgba(0,245,212,0.08))}to{filter:drop-shadow(0 0 28px rgba(0,180,216,0.18))}}
  .controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:6px}
  .btn{padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.03),transparent);border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:700}
  /* categories */
  .cats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
  @media(max-width:420px){.cats{grid-template-columns:1fr}}
  .cat{padding:10px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);cursor:pointer}
  .cat .title{font-weight:700;color:var(--neon);display:flex;align-items:center;gap:8px}
  .qs{margin-top:8px;display:flex;flex-direction:column;gap:8px;max-height:0;overflow:hidden;transition:max-height .36s ease}
  .qs.open{max-height:240px;padding-right:6px}
  .qitem{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:700;color:var(--muted);display:flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,0.02)}
  .qitem:hover{background:linear-gradient(90deg, rgba(0,245,212,0.03), rgba(0,180,216,0.02));color:var(--neon)}
  footer{display:flex;align-items:center;justify-content:center;padding:10px;margin-top:6px}
  .copyright{padding:6px 12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);box-shadow:0 6px 24px rgba(0,0,0,0.3);font-weight:700;color:var(--neon);font-size:13px}
</style>
</head>
<body>
<div class="bg" aria-hidden>
  <div class="orb o1"></div>
  <div class="orb o2"></div>
</div>

<div class="app" role="application" aria-label="Sanita Mobil AI">
  <header>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="logo">ST</div>
      <div>
        <h1>Sanita â€” Yapay Zeka Bilgi AsistanÄ±yÄ±m</h1>
        <div class="subtitle">DilediÄŸini sorabilirsin.</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <select id="voiceSelect" aria-label="Ses seÃ§imi"><option value="best">ğŸ¤ En iyi</option><option value="female">ğŸ‘© KadÄ±n</option><option value="male">ğŸ‘¨ Erkek</option></select>
      <button id="download" class="btn">â¬‡ï¸ Ä°ndir</button>
    </div>
  </header>

  <main class="card" role="main">
    <!-- flowing transcript -->
    <div class="transcript" aria-live="polite">
      <div class="pulse" aria-hidden></div>
      <div class="flow"><span class="txt" id="flowText">Merhaba ben Sanita Yapay Zeka Bilgi AsistanÄ±yÄ±m. DilediÄŸini sorabilirsin. Sesli komut iÃ§in mikrofona dokunabilir veya kategorilerden bir soru seÃ§ebilirsin.</span></div>
    </div>

    <!-- bubbles -->
    <div class="bubbles" id="bubbles" aria-live="polite" aria-atomic="false"></div>

    <!-- mic and controls -->
    <div class="mic-row">
      <div id="mic" class="mic" title="Mikrofonu baÅŸlat">ğŸ¤</div>
    </div>

    <div class="controls" aria-hidden>
      <button id="clear" class="btn">ğŸ§¹ Temizle</button>
      <div style="flex:1;text-align:center;color:var(--muted);font-weight:700">KonuÅŸma baloncuklarÄ±nda cevaplar gÃ¶rÃ¼nÃ¼r.</div>
    </div>

    <!-- categories -->
    <div class="cats" id="cats">
      <div class="cat" data-cat="personel">
        <div class="title">ğŸ‘¥ Personel</div>
        <div class="qs" id="qs-personel">
          <div class="qitem" data-q="kaÃ§ kiÅŸi Ã§alÄ±ÅŸtÄ± bu ay?">ğŸ‘· KaÃ§ kiÅŸi Ã§alÄ±ÅŸtÄ± bu ay?</div>
          <div class="qitem" data-q="toplam Ã§alÄ±ÅŸma sÃ¼resi kaÃ§ saattir?">â± Toplam Ã§alÄ±ÅŸma sÃ¼resi kaÃ§ saattir?</div>
          <div class="qitem" data-q="kiÅŸi baÅŸÄ±na ortalama Ã¼retim ne kadar?">ğŸ“Š KiÅŸi baÅŸÄ±na ortalama Ã¼retim ne kadar?</div>
        </div>
      </div>

      <div class="cat" data-cat="uretim">
        <div class="title">ğŸ­ Ãœretim</div>
        <div class="qs" id="qs-uretim">
          <div class="qitem" data-q="toplam Ã¼retim miktarÄ± nedir?">ğŸ“¦ Toplam Ã¼retim miktarÄ± nedir?</div>
          <div class="qitem" data-q="ortalama saatlik Ã¼retim kaÃ§ adettir?">âš™ Ortalama saatlik Ã¼retim kaÃ§ adettir?</div>
          <div class="qitem" data-q="1 adet iÃ§in ortalama hammadde tÃ¼ketimi nedir?">ğŸ“ˆ 1 adet iÃ§in ortalama hammadde tÃ¼ketimi nedir?</div>
        </div>
      </div>

      <div class="cat" data-cat="hammadde">
        <div class="title">ğŸ§‚ Hammadde</div>
        <div class="qs" id="qs-hammadde">
          <div class="qitem" data-q="pul biberinden kaÃ§ kilo kullanÄ±ldÄ±?">ğŸŒ¶ Pul biberinden kaÃ§ kilo kullanÄ±ldÄ±?</div>
          <div class="qitem" data-q="toplam kullanÄ±lan hammadde miktarÄ± nedir?">ğŸ¥£ Toplam kullanÄ±lan hammadde miktarÄ± nedir?</div>
          <div class="qitem" data-q="en Ã§ok hangi hammadde kullanÄ±ldÄ±?">ğŸ” En Ã§ok hangi hammadde kullanÄ±ldÄ±?</div>
        </div>
      </div>

      <div class="cat" data-cat="firma">
        <div class="title">ğŸ¢ Firma</div>
        <div class="qs" id="qs-firma">
          <div class="qitem" data-q="sofra firmasÄ±nÄ±n Ã¼retim miktarÄ± nedir?">ğŸ·ï¸ SOFRA firmasÄ±nÄ±n Ã¼retim miktarÄ± nedir?</div>
          <div class="qitem" data-q="mesa firmasÄ±nÄ±n kullandÄ±ÄŸÄ± toplam hammadde kaÃ§ kg?">ğŸŒ¾ MESA firmasÄ±nÄ±n kullandÄ±ÄŸÄ± toplam hammadde kaÃ§ kg?</div>
          <div class="qitem" data-q="en fazla Ã¼retim yapan firma hangisidir?">ğŸ” En fazla Ã¼retim yapan firma hangisidir?</div>
        </div>
      </div>

      <div class="cat" data-cat="fire">
        <div class="title">ğŸ”¥ Fire</div>
        <div class="qs" id="qs-fire">
          <div class="qitem" data-q="toplam hammadde fire miktarÄ± kaÃ§ kg?">âš ï¸ Toplam hammadde fire miktarÄ± kaÃ§ kg?</div>
          <div class="qitem" data-q="omk ve opp fire toplamÄ± nedir?">ğŸ§¾ OMK ve OPP fire toplamÄ± nedir?</div>
          <div class="qitem" data-q="fire oranÄ± toplam hammaddeye gÃ¶re yÃ¼zde kaÃ§?">ğŸ“‰ Fire oranÄ± toplam hammaddeye gÃ¶re yÃ¼zde kaÃ§?</div>
        </div>
      </div>

      <div class="cat" data-cat="ozet">
        <div class="title">ğŸ“… Ã–zet</div>
        <div class="qs" id="qs-ozet">
          <div class="qitem" data-q="aylÄ±k toplam hammadde kaÃ§ kg olarak kaydedilmiÅŸ?">ğŸ—“ AylÄ±k toplam hammadde kaÃ§ kg olarak kaydedilmiÅŸ?</div>
          <div class="qitem" data-q="genel toplam Ã¼retim 211.991 adet midir?">ğŸ“Š Genel toplam Ã¼retim 211.991 adet midir?</div>
          <div class="qitem" data-q="veri setine gÃ¶re en verimli Ã¼Ã§ firma hangileridir?">âœ… Veri setine gÃ¶re en verimli Ã¼Ã§ firma hangileridir?</div>
        </div>
      </div>
    </div>

  </main>

  <footer><div class="copyright">Â© 2025 Yapay Zeka GeliÅŸtiricisi: Bilal TektaÅŸ ğŸ¤–</div></footer>
</div>

<script>
// ==== New embedded hammaddeler data from user image/table ====
const HAMMADDELER = {
  "Ã‡AM FISTIÄI":160.00,"YENÄ°BAHAR":920.05,"PULBÄ°BER":20107.24,"TÃœM BÄ°BER":299.00,"DEFNE YAPRAÄI":204.46,
  "KEKÄ°K":2552.74,"Ä°SOT":4130.77,"ANASON":559.52,"HÄ°NDÄ°STAN CEVÄ°ZÄ°":4154.01,"IHLAMUR":102.00,"MAVÄ° HAÅHAÅ":260.00,
  "Ã‡EÅNÄ° MILD SEASONING":120.00,"VANÄ°LÄ°N ÅEKERLÄ°":310.00,"SUMAK":1666.49,"BÄ°BERÄ°YE":1436.54,"MÄ°X MARINATION":120.00,
  "TUZOT":120.00,"TARÃ‡IN":2763.43,"KÄ°MYON":4475.46,"KÃ–RÄ°":1670.06,"LÄ°MON TUZU":9441.80,"KARABÄ°BER":3020.10,
  "TOZ BÄ°BER":14818.43,"NÄ°ÅASTA BUÄDAY":100.00,"MAHLEP":38.80,"KARBONAT":342.00,"Ã‡Ã–REKOTU":30.00,"GALETA UNU":8770.10,
  "KUÅ ÃœZÃœMÃœ":1620.00,"BEYAZ HAÅHAÅ":10.00,"SARIMSAK":971.80,"NÄ°ÅASTA MISIR":500.00,"ZERDEÃ‡AL":743.00,"PÄ°ZZA SPÄ°CE MÄ°X":25.20,
  "KEBAP SPICE MÄ°X":19.20,"NANE":3869.95,"MAYDANOZ":496.80,"CHÄ°CKEN SEASONING MÄ°X":19.20,"SPÄ°CE MIX":19.20,"BAHARAT KARIÅIMI":26.88,
  "FESLEÄEN":534.90,"SUSAM":2721.90,"ZENCEFÄ°L":196.10,"KÄ°ÅNÄ°Å":55.68,"DEREOTU":26.06,"SOÄAN":20.00,"BAMYA KURUSU":5.00,
  "YER FISTIÄI":60.10,"SHAWARMA Ã‡EÅNÄ°SÄ°":13.50,"MASALA Ã‡EÅNÄ°SÄ°":12.00,"DENÄ°Z ÃœRÃœNLERÄ° Ã‡EÅNÄ°SÄ°":13.50,"YEMEKLÄ°K TUZ":30.00,
  "TAVUK Ã‡EÅNÄ°SÄ°":10.50,"BARBEKÃœ Ã‡EÅNÄ°SÄ°":15.00,"ET Ã‡EÅNÄ°SÄ°":15.00,"MISIR UNU":1850.30,"HÄ°MALAYA TUZU":1033.20,"KAJUN Ã‡EÅNÄ°SÄ°":12.00,
  "MÄ°X 7 TÃœRLÃœ":215.20,"DENÄ°Z TUZU":390.72,"MUSKAT":98.40,"SALATA Ã‡EÅNÄ°":8.10,"PATATES Ã‡EÅNÄ°":18.00,"MAKARNA Ã‡EÅNÄ°":8.10,
  "KABARTMA TOZU":10.00,"KAYA TUZU":288.00,"BALIK MÄ°X":43.20,"PÄ°RÄ°NÃ‡ UNU":100.00,"SOS BAHARATI":50.00,"BUÄDAY NÄ°ÅASTA":100.00,
  "AKBÄ°BER":20.00
};

// Existing DATA (monthly + firms)
const DATA = {
  aylik:{kisi:418.00, calisma_saat:951.75, uretim_adet:211991.00, toplam_hammadde:99126.68, hammadde_fire:5.48, omk_fire:28.00, opp_fire:15.80},
  firmalar:{
    "SOFRA":{uret:31477,hammadde:29055.17},"KERVAN":{uret:764,hammadde:764.00},"RECEP CAN":{uret:1952,hammadde:4760.07},
    "EVERGREEN":{uret:48122,hammadde:9921.44},"BEDÄ°R TEDARÄ°K":{uret:1964,hammadde:1702.30},"Ã–NEN GIDA":{uret:100,hammadde:100.00},
    "Ã‡ELÄ°K NATUREL":{uret:100,hammadde:100.00},"ÅEKERCÄ°":{uret:10484,hammadde:11828.14},"GENÄ°M GIDA":{uret:5173,hammadde:4760.51},
    "AKAR FOOD":{uret:11454,hammadde:1170.48},"MAUN GIDA":{uret:550,hammadde:550.00},"VENÃœS":{uret:3660,hammadde:2579.00},
    "ANADOLU ÃœNÄ°VERSÄ°TESÄ°":{uret:340,hammadde:310.00},"EKOL FOOD":{uret:864,hammadde:723.00},"SANITA EVERGREEN":{uret:672,hammadde:336.00},
    "MESA":{uret:70990,hammadde:9804.16},"CASH&CARRY":{uret:13522,hammadde:15307.80},"BORTAR":{uret:797,hammadde:703.50},
    "VKS":{uret:1794,hammadde:1002.00},"HABÄ°P ALBAYRAK":{uret:1086,hammadde:1008.15},"FATSAT":{uret:320,hammadde:320.00},
    "NIOLES":{uret:750,hammadde:340.65},"SALEH":{uret:4224,hammadde:1024.32},"KIRÃ‡Ä°Ã‡EÄÄ°":{uret:50,hammadde:50.00},
    "MAYA CATERÄ°NG":{uret:42,hammadde:36.00},"T DÃ–NER":{uret:500,hammadde:50.00},"FRESH FOOD":{uret:50,hammadde:50.00},
    "EGES YEMEK":{uret:190,hammadde:190.00},"_GENEL_TOPLAM_FIRMA_HAMMADDE":98546.68
  }
};

// helpers
function fmt(n){ return (typeof n==='number')? n.toLocaleString('tr-TR') : n; }
function maxHammadde(){
  const entries = Object.entries(HAMMADDELER);
  let max = entries[0];
  for(const e of entries){ if(e[1] > max[1]) max = e; }
  return max; // [name, value]
}

// append bubble
function appendBubble(txt, who='ai', emoji='ğŸ¤–'){
  const bubbles = document.getElementById('bubbles');
  const el = document.createElement('div'); el.className = 'bubble '+(who==='user'?'user':'ai');
  el.innerHTML = `<span class="emoji">${emoji}</span><span class="txt">${txt}</span>`;
  bubbles.appendChild(el); bubbles.scrollTop = bubbles.scrollHeight;
  return el;
}

// speak (choose best available voice)
function speak(text){
  try{
    const u = new SpeechSynthesisUtterance(text); u.lang='tr-TR'; u.rate=1; u.pitch=1;
    const pref = document.getElementById('voiceSelect').value;
    const voices = speechSynthesis.getVoices();
    let candidate = voices.find(v=>/tr-?tr|turkish/i.test(v.lang)) || voices.find(v=>/female|kadÄ±n/i.test(v.name)) || voices[0] || null;
    if(pref==='male') candidate = voices.find(v=>/male|erkek/i.test(v.name)) || candidate;
    if(pref==='female') candidate = voices.find(v=>/female|kadÄ±n/i.test(v.name)) || candidate;
    if(candidate) u.voice = candidate;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  }catch(e){console.warn(e)}
}

// matching + answering, enhanced to use HAMMADDELER
function enYuksek(key){
  return Object.entries(DATA.firmalar).filter(([k])=>!k.startsWith('_')).map(([k,v])=>({firma:k,val:v[key]})).sort((a,b)=>b.val-a.val);
}
function answerFor(text){
  const t = text.toLowerCase();
  // hammaddeler specific
  if(/en Ã§ok hangi hammadde|en cok hangi hammadde|en fazla hammadde/i.test(t)){
    const m = maxHammadde();
    return `${m[0]} en Ã§ok kullanÄ±lan hammadde: ${fmt(m[1])} kg.`;
  }
  // direct lookup for a specific hammadde (e.g., pul biber)
  for(const name of Object.keys(HAMMADDELER)){
    const key = name.toLowerCase();
    if(t.includes(key)){
      return `${name} toplam kullanÄ±m: ${fmt(HAMMADDELER[name])} kg.`;
    }
  }
  // other patterns (same as before)
  if(/toplam Ã¼retim|Ã¼retim miktarÄ±|genel toplam Ã¼retim/i.test(t)) return `Toplam Ã¼retim ${fmt(DATA.aylik.uretim_adet)} adet.`;
  if(/toplam (kullanÄ±lan )?hammadde|toplam hammadde/i.test(t)) return `Toplam kullanÄ±lan hammadde ${fmt(DATA.aylik.toplam_hammadde)} kg.`;
  if(/kaÃ§ kiÅŸi|kiÅŸi sayÄ±sÄ±|personel|kaÃ§ Ã§alÄ±ÅŸan/i.test(t)) return `Toplam ${fmt(DATA.aylik.kisi)} kiÅŸi Ã§alÄ±ÅŸtÄ±.`;
  if(/Ã§alÄ±ÅŸma sÃ¼resi|Ã§alÄ±ÅŸma saati|toplam saat/i.test(t)) return `Toplam Ã§alÄ±ÅŸma sÃ¼resi ${fmt(DATA.aylik.calisma_saat)} saattir.`;
  if(/hammadde fire|omk|opp|toplam fire|fire miktarÄ±/i.test(t)) return `Hammadde fire ${fmt(DATA.aylik.hammadde_fire)} kg, OMK fire ${fmt(DATA.aylik.omk_fire)} kg, OPP fire ${fmt(DATA.aylik.opp_fire)} kg. Toplam fire ${(DATA.aylik.hammadde_fire+DATA.aylik.omk_fire+DATA.aylik.opp_fire).toFixed(2)} kg.`;
  if(/kiÅŸi baÅŸÄ±|kiÅŸi baÅŸÄ±na/i.test(t)) return `KiÅŸi baÅŸÄ±na dÃ¼ÅŸen Ã¼retim ${(DATA.aylik.uretim_adet/DATA.aylik.kisi).toFixed(2)} adet.`;
  if(/saatlik Ã¼retim|1 saatte|saatte ortalama/i.test(t)) return `Ortalama saatlik Ã¼retim ${(DATA.aylik.uretim_adet/DATA.aylik.calisma_saat).toFixed(2)} adettir.`;
  if(/ortalama hammadde|1 adet.*hammadde/i.test(t)) return `Ortalama hammadde kullanÄ±mÄ± ${(DATA.aylik.toplam_hammadde/DATA.aylik.uretim_adet).toFixed(4)} kg/adet.`;
  // firm lookups
  for(const fname of Object.keys(DATA.firmalar)){
    if(fname.startsWith('_')) continue;
    const key = fname.toLowerCase();
    if(t.includes(key)){
      const info = DATA.firmalar[fname];
      if(/Ã¼retim|kaÃ§ adet|Ã¼retim miktarÄ±/i.test(t)) return `${fname} firmasÄ±nÄ±n Ã¼retim miktarÄ± ${fmt(info.uret)} adettir.`;
      if(/hammadde|kaÃ§ kg|kullandÄ±/i.test(t)) return `${fname} firmasÄ±nÄ±n kullandÄ±ÄŸÄ± toplam hammadde ${fmt(info.hammadde)} kg.`;
      if(/ortalama|adet baÅŸÄ±|1 adet/i.test(t)) return `${fname} iÃ§in ortalama hammadde/adet ${(info.hammadde/(info.uret||1)).toFixed(4)} kg.`;
    }
  }
  if(/en fazla Ã¼retim|en Ã§ok Ã¼retim|en fazla Ã¼retim yapan/i.test(t)){ const top=enYuksek('uret')[0]; return `En fazla Ã¼retim yapan firma ${top.firma} â€” ${fmt(top.val)} adet.`; }
  if(/en az Ã¼retim|en dÃ¼ÅŸÃ¼k Ã¼retim/i.test(t)){ const arr=enYuksek('uret'); const bot=arr[arr.length-1]; return `En az Ã¼retim yapan firma ${bot.firma} â€” ${fmt(bot.val)} adet.`; }
  if(/en Ã§ok hammadde|en fazla hammadde/i.test(t)){ const top=enYuksek('hammadde')[0]; return `En Ã§ok hammadde kullanan firma ${top.firma} â€” ${fmt(top.val)} kg.`; }
  if(/en verimli|verimlilik/i.test(t)){ const arr=Object.entries(DATA.firmalar).filter(([k])=>!k.startsWith('_')).map(([k,v])=>({firma:k,ratio:v.uret/(v.hammadde||1)})).sort((a,b)=>b.ratio-a.ratio); return `En verimli ilk 3 firma: ${arr.slice(0,3).map(x=>x.firma+' ('+x.ratio.toFixed(3)+')').join(', ')}.`; }
  if(/yÃ¼zde pay|yÃ¼zde paylarÄ±|yÃ¼zde pay/i.test(t)){ const totalU=DATA.aylik.uretim_adet; const totalH=DATA.aylik.toplam_hammadde; const lines=Object.entries(DATA.firmalar).filter(([k])=>!k.startsWith('_')).map(([k,v])=>`${k}: Ã¼retim %${((v.uret/totalU)*100).toFixed(2)}, hammadde %${((v.hammadde/totalH)*100).toFixed(2)}`); return `FirmalarÄ±n Ã¼retim ve hammadde yÃ¼zde paylarÄ±:\\n`+lines.join('\\n'); }
  return null;
}

// UI interactions
document.querySelectorAll('.cat').forEach(cat=>{
  cat.addEventListener('click',()=>{
    const qs = cat.querySelector('.qs');
    qs.classList.toggle('open');
  });
});
document.querySelectorAll('.qitem').forEach(q=> q.addEventListener('click', ()=> handleQuestion(q.dataset.q, true)));

// SpeechRecognition
const mic = document.getElementById('mic');
const flowText = document.getElementById('flowText');
const bubbles = document.getElementById('bubbles');
let rec=null;
if('SpeechRecognition' in window || 'webkitSpeechRecognition' in window){
  const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
  rec = new Rec(); rec.lang='tr-TR'; rec.interimResults=false; rec.maxAlternatives=1;
  rec.onresult = (e)=>{ const text = e.results[0][0].transcript; flowText.textContent = text; handleQuestion(text, false); mic.classList.remove('record'); }
  rec.onerror = (e)=>{ flowText.textContent = 'Mikrofon hatasÄ±. LÃ¼tfen tekrar deneyin.'; mic.classList.remove('record'); }
} else {
  flowText.textContent = 'TarayÄ±cÄ±nÄ±z konuÅŸma tanÄ±mayÄ± desteklemiyor. SorularÄ± tÄ±klayarak sorabilirsiniz.';
  mic.style.opacity = 0.7;
}

mic.addEventListener('click', ()=>{
  if(rec){
    try{ rec.start(); flowText.textContent='Dinleniyor... KonuÅŸun.'; mic.classList.add('record'); } catch(e){ rec.stop(); mic.classList.remove('record'); }
  }
});

// handle question
function handleQuestion(text, fromClick){
  // show user bubble
  appendBubble(text,'user','ğŸ—£ï¸');
  // update flow text for visual effect
  flowText.textContent = text;
  // compute answer
  setTimeout(()=>{
    const ans = answerFor(text) || 'ÃœzgÃ¼nÃ¼m, bu sorunun cevabÄ± veri setinde aÃ§Ä±kÃ§a bulunmuyor.';
    const el = appendBubble(ans,'ai','ğŸ¤–');
    const meta = document.createElement('div'); meta.className='meta'; meta.textContent = 'Cevap: veriye dayalÄ± sonuÃ§'; el.appendChild(meta);
    speak(ans);
  },350);
}

// clear
document.getElementById('clear').addEventListener('click', ()=>{ bubbles.innerHTML=''; flowText.textContent=''; });

// download
document.getElementById('download').addEventListener('click', ()=>{
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'sanita-ai-mobile-hammaddeler.html'; document.body.appendChild(a); a.click(); a.remove();
});

// initial greeting + spoken usage
setTimeout(()=>{
  const greet = 'Merhaba ben Sanita Yapay Zeka Bilgi AsistanÄ±yÄ±m. DilediÄŸini sorabilirsin.';
  appendBubble(greet,'ai','ğŸ¤–');
  speak('Merhaba ben Sanita Yapay Zeka Bilgi AsistanÄ±yÄ±m. DilediÄŸini sorabilirsin. Sesli komut iÃ§in mikrofon dÃ¼ÄŸmesine dokunabilirsiniz.');
},700);
</script>
</body>
</html>
